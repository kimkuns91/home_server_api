# =============================================================================
# Cloudflare Proxy 뒤에서 HTTP 모드로 동작 (Flexible SSL)
# =============================================================================

api.whitemouse.dev:80 {
	# Cloudflare 실제 클라이언트 IP 사용
	# CF-Connecting-IP 헤더를 X-Forwarded-For로 전달
	header_up X-Real-IP {header.CF-Connecting-IP}
	header_up X-Forwarded-For {header.CF-Connecting-IP}

	reverse_proxy api:8000
}

# =============================================================================
# [참고] Cloudflare Origin CA를 사용한 Full (Strict) SSL 전환 방법
# =============================================================================
#
# 1. Cloudflare Dashboard > SSL/TLS > Origin Server에서 Origin Certificate 생성
#    - 15년 유효기간 선택 가능
#    - PEM 형식으로 다운로드
#
# 2. 인증서 파일을 프로젝트에 저장:
#    - certs/origin.pem (Certificate)
#    - certs/origin-key.pem (Private Key)
#
# 3. docker-compose.yml의 caddy 서비스에 볼륨 추가:
#    volumes:
#      - ./Caddyfile:/etc/caddy/Caddyfile
#      - ./certs:/etc/caddy/certs:ro
#
# 4. Caddyfile을 아래와 같이 수정:
#
#    api.whitemouse.dev:443 {
#        tls /etc/caddy/certs/origin.pem /etc/caddy/certs/origin-key.pem
#
#        header_up X-Real-IP {header.CF-Connecting-IP}
#        header_up X-Forwarded-For {header.CF-Connecting-IP}
#
#        reverse_proxy api:8000
#    }
#
#    # HTTP를 HTTPS로 리다이렉트 (선택사항, Cloudflare에서도 처리 가능)
#    api.whitemouse.dev:80 {
#        redir https://{host}{uri} permanent
#    }
#
# 5. docker-compose.yml에서 포트 변경:
#    ports:
#      - "443:443"
#      - "80:80"
#
# 6. Cloudflare Dashboard > SSL/TLS > Overview에서 "Full (strict)" 선택
#
# =============================================================================
